<h2 class="auth-h2" style="padding-top: 0%;"><%= @vehicle.year %> <%= @vehicle.make %> <%= @vehicle.model %></h2>


<!----------- button to launch modal to add maintenance --------------->
<div class="modal-button-wrapper">
    <p style="margin-bottom: 0;"><a style="margin-bottom:0;border-radius: 5px;" class="add button"href="#serviceModal" rel="modal:open">Add Maintenance</a></p>
</div>

<!----------- Modal to add a new maintenance --------------->
<div class="vehicle-form-wrapper modal" id="serviceModal">
    <form class="vehicle-form" action="<%= vehicle_maintenance_items_url(@vehicle) %>" method="POST">

        <h3>Add Maintenance</h3>

        <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">

        <label for="title">Title
            <input type="text" name="maintenance_item[title]" value="" id="title" placeholder="Enter Title">
        </label>

        <label for="date_preformed">Date Preformed
            <input type="date" name="maintenance_item[date_preformed]" value="" id="date_preformed" placeholder="Add Date Preformed">
        </label>

        <label for="current_mileage">Current Mileage
            <input type="number" name="maintenance_item[current_mileage]" value="" id="current_mileage" placeholder="Add Current Mileage">
        </label>

        <label for="comment">Comment
            <input type="text" name="maintenance_item[comment]" value="" id="comment" placeholder="Add Comment">
        </label>

        <label for="cost">Cost
            <input type="number" name="maintenance_item[cost]" value="" id="cost" placeholder="Add Cost">
        </label>

        <input type="submit"  class="auth-submit expanded button" value="Add Maintenance">
        
    </form>
</div>


<!-- Creating list elements for each maintenance item -->
<div class="grid-container">
    

    <% @vehicle.maintenance_items.map do |maintenance| %>

        <div style="border:1px solid black;" class="grid-x grid-margin-x">

            <div class="flex-container align-center small-12 cell">
                <h4 class="my-h4">
                    <a><%= maintenance.title %></a>  
                </h4>
            </div>

            <div class="small-12 large-3 cell">
                on <%= maintenance.date_preformed %>
            </div>

            <div class="small-12 large-3 cell">
                $<%= maintenance.cost %>
            </div>

            <div class="small-12 large-3 cell">
                <a class="button small xdf" href="<%= edit_vehicle_maintenance_item_url(@vehicle, maintenance) %>">Edit</a>                                            
            </div>

</div>




        <div class="maintenance-items large-4 medium-6 small-12 cell" id="<%= maintenance.id %>">

            <!-- Top Row -->
            <div class="grid-x">
                <div class="small-10 small-offset-1 cell">
                    <h4 class="my-h4">
                        <a><%= maintenance.title %></a>  
                    </h4>
                </div>
            </div>

            <!-- Bottom Row -->
            <div class="grid-container">
                <div class="grid-x">

                    <div class="flex-container align-center small-6 cell">
                        <a class="button small xdf" href="<%= edit_vehicle_maintenance_item_url(@vehicle, maintenance) %>">Edit</a>                                            
                    </div>

                    <div class="flex-container align-center small-6 cell">
                        <form action="<%= vehicle_maintenance_item_url(@vehicle, maintenance) %>" method="POST">
                            <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
                            <input type="hidden" name="_method" value="DELETE">
                            <input class="remove button small" type="submit" value="Remove"/>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    <% end %>

</div>

<div class="back-button-wrapper">
    <a class="auth-submit button" href="<%= vehicles_url %>">Back to your garage</a>
</div>



<script>


    // Stop Event Bubbling when clicking child element    
    $('.xdf').click(function(e){
        e.stopPropagation();
    });

    $('.maintenance-items').click( (data) => {
        const maintenance_id = parseInt(data.currentTarget.id);
        const urlArr = window.location.href.split('/');
        const vehicleId = parseInt(urlArr.pop());
        window.location.href = `/vehicles/${vehicleId}/maintenance_items/${maintenance_id}`;
     });

</script>